---
title: MySQL 扩展
date: 2020-04-06 23:31:32
tags: [MySQL]
categories: [数据库]
---


当 MySQL 规模变的越来越大时， 如何保证高效且经济？

<!--more-->

# 可扩展性

可扩展性表明当需要增加资源以执行更多工作时系统能获得收益的同等提升。 缺乏扩展能力的系统达到收益递减的转折点后， 将无法进一步增长。

系统是否需要扩展一般从哪个四个因素进行衡量：
* 数据量
* 用户量
* 用户活跃度
* 相关数据集大小

增加服务器并不能完全增加系统的吞吐率， 大多数情况下都属于 USL 扩展

# 如何扩展 MySQL

MySQL 扩展通常分为"垂直"扩展和"水平"扩展。 垂直扩展就是增加更多的机器， 水平扩展是将任务拆分分配到多台机器上。

## 知晓系统的底线

* 应用的功能是否都开发完毕了？ 是否到了需要扩展的阶段了。
* 预期的最大负载是多少？
* 如果局部失效如何防范。

## 扩展前先优化

* 优化性能
* 升级硬件

## 向上扩展-垂直扩展

建议使用更新的 MySQL 版本， 最大的配置是 256G RAM， 32 核 CPU， 再之后收益就递减了。
但是向上扩展的开销太大了， 并不是很好的选择。


## 向外扩展-水平扩展

向外扩展可以分为三步：复制、拆分和数据分片

最简单的做法是通过复制将数据分发到多个服务器上， 通过备库进行读查询， 对以读为主的应用很有效。 此外常见的做法是工作负载到多个节点， 其中节点可能是一个服务器， 也可能是一个集群， 通常有以下几种：

* 一个主-主复制双机机构， 一个主动，一个被动；
* 一主多备
* 一个主动服务器，使用分布式复制设备作为备库
* 一个基于存储区域网络的集群

下面是一些不同的分布负载方案

### 按功能拆分

不同的节点执行不同的任务，比如门户网站将论坛、新闻、知识库等不同的功能所需的数据存在不同的数据库中。

此外也可以对单台服务器的数据进行划分， 前提是表与表之间不会进行关联操作。

实际上不能通过功能划分进行无限扩展， 当一个功能与单个 MySQL 绑定后就只能垂直扩展了。

### 数据分片

在扩展大型 MySQL 应用的方案中，数据分片是最通用且最成功的方法。在数据分片前需要考虑当前的应用是否需要分片， 比如正在搭建的博客网站， 预计有 1000 万用户，这个时候就算把所以用户数据放在内存中也是可行的， 但是当用户达到 5 亿时就可能需要对数据进行分片了。

如果在设计之初就已经预计到分片， 之后分片就会容易很多。

单台服务器的功能划分：

![单台机器](/单台机器.jpg)


继续演进， 通过用户 ID 对文章和内容进行分片：
![分布式存储](/分布式存储.jpg)

如果事先知道应用会扩展到很大规模且了解功能划分的局限性， 就可以跳过中间步骤， 直接从单个节点升级为分片数据存储。

















